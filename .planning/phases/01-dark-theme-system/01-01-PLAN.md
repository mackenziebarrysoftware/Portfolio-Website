---
phase: 01-dark-theme-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - package-lock.json
  - src/components/theme/ThemeProvider.tsx
  - src/app/layout.tsx
  - src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "Theme system prevents FOUC on page load"
    - "Theme preference persists across browser sessions"
    - "Server and client rendering match without hydration errors"
  artifacts:
    - path: "src/components/theme/ThemeProvider.tsx"
      provides: "Client wrapper for next-themes"
      min_lines: 15
    - path: "src/app/layout.tsx"
      contains: "suppressHydrationWarning"
      provides: "Theme provider integration"
    - path: "src/app/globals.css"
      contains: "@custom-variant dark"
      provides: "Tailwind v4 dark mode configuration"
  key_links:
    - from: "src/app/layout.tsx"
      to: "src/components/theme/ThemeProvider.tsx"
      via: "wraps children with provider"
      pattern: "<ThemeProvider"
    - from: "src/components/theme/ThemeProvider.tsx"
      to: "next-themes"
      via: "imports and wraps NextThemesProvider"
      pattern: "from 'next-themes'"
---

<objective>
Establish theme system infrastructure using next-themes to enable dark/light mode switching without FOUC.

Purpose: next-themes handles localStorage persistence, system preference detection, and FOUC prevention automatically - battle-tested across thousands of production apps. Tailwind v4 requires CSS-native dark mode configuration using @custom-variant directive.

Output: Working theme system ready for color token configuration and toggle UI.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-dark-theme-system/01-RESEARCH.md
@.planning/codebase/STACK.md
@.planning/codebase/ARCHITECTURE.md
@src/app/layout.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install next-themes and configure Tailwind v4 dark mode</name>
  <files>
    package.json
    package-lock.json
    src/app/globals.css
  </files>
  <action>
Install next-themes library:
```bash
npm install next-themes
```

Add Tailwind v4 dark mode variant to globals.css immediately after the @import statement:
```css
@import "tailwindcss";

@custom-variant dark (&:where(.dark, .dark *));

@theme {
  /* existing theme variables */
}
```

This @custom-variant directive is REQUIRED for Tailwind v4 class-based dark mode (dark: prefix). Do NOT try to configure in tailwind.config.js - v4 removed darkMode: 'class' from JS config.
  </action>
  <verify>
Run `npm list next-themes` to confirm installation. Verify @custom-variant line exists in globals.css after @import.
  </verify>
  <done>
next-themes appears in package.json dependencies, @custom-variant dark directive present in globals.css before @theme block.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ThemeProvider wrapper component</name>
  <files>
    src/components/theme/ThemeProvider.tsx
  </files>
  <action>
Create new directory src/components/theme/ and file ThemeProvider.tsx:

```typescript
'use client'

import { ThemeProvider as NextThemesProvider } from 'next-themes'
import { type ThemeProviderProps } from 'next-themes/dist/types'

export function ThemeProvider({ children, ...props }: ThemeProviderProps) {
  return <NextThemesProvider {...props}>{children}</NextThemesProvider>
}
```

This must be a client component ('use client' directive) because next-themes uses React hooks and browser APIs. It wraps NextThemesProvider to avoid marking parent components as client components unnecessarily.
  </action>
  <verify>
File exists at src/components/theme/ThemeProvider.tsx, contains 'use client' directive, imports from next-themes, exports ThemeProvider function.
  </verify>
  <done>
ThemeProvider.tsx created with client directive and proper next-themes integration.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate ThemeProvider in root layout</name>
  <files>
    src/app/layout.tsx
  </files>
  <action>
Update layout.tsx to integrate theme system:

1. Import ThemeProvider at top:
```typescript
import { ThemeProvider } from '@/components/theme/ThemeProvider'
```

2. Add suppressHydrationWarning to html tag (prevents React warnings from theme script):
```typescript
<html lang="en" suppressHydrationWarning className={`${cormorant.variable} ${workSans.variable}`}>
```

3. Wrap body content with ThemeProvider:
```typescript
<body className="min-h-screen">
  <ThemeProvider
    attribute="class"
    defaultTheme="dark"
    enableSystem
    disableTransitionOnChange={false}
  >
    <Navbar />
    <main>{children}</main>
    <Footer />
  </ThemeProvider>
</body>
```

Configuration explained:
- attribute="class": Adds .dark class to html element (required for Tailwind)
- defaultTheme="dark": Dark theme as default per DSGN-01
- enableSystem: Respects prefers-color-scheme as fallback
- disableTransitionOnChange={false}: Enables smooth theme transitions (Framer Motion available)
  </action>
  <verify>
Run `npm run build` to verify no TypeScript errors. Check that layout.tsx imports ThemeProvider, html has suppressHydrationWarning, and body content is wrapped with ThemeProvider.
  </verify>
  <done>
layout.tsx successfully integrates theme system, build passes without errors, suppressHydrationWarning present on html tag.
  </done>
</task>

</tasks>

<verification>
1. Run `npm run dev` and inspect browser console - no hydration warnings
2. Check localStorage in DevTools - no theme key yet (will be set when user toggles)
3. Inspect html element in DevTools - should have .dark class on page load
4. Verify next-themes blocking script injected in <head> before app hydration
</verification>

<success_criteria>
- next-themes installed (appears in package.json)
- @custom-variant dark directive added to globals.css
- ThemeProvider component created in src/components/theme/
- Root layout integrates ThemeProvider with correct props
- No hydration errors in browser console
- Build completes successfully without TypeScript errors
- HTML element receives .dark class on initial page load
</success_criteria>

<output>
After completion, create `.planning/phases/01-dark-theme-system/01-01-SUMMARY.md` documenting:
- next-themes installation and version
- ThemeProvider configuration choices (defaultTheme="dark", enableSystem, etc.)
- How @custom-variant works in Tailwind v4
- Any implementation notes or deviations from plan
</output>
