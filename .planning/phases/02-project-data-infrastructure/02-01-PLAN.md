---
phase: 02-project-data-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - package-lock.json
  - src/data/schemas/project.schema.ts
  - src/data/projects.ts
  - src/types/project.ts
  - src/data/index.ts
  - src/components/home/Projects.tsx
autonomous: true

must_haves:
  truths:
    - "New projects can be added by editing src/data/projects.ts without code changes"
    - "Invalid project data causes build to fail with clear Zod validation errors"
    - "Project data structure validates at build time against Zod schema"
    - "Components consume typed project data with autocomplete and type safety"
  artifacts:
    - path: "src/data/schemas/project.schema.ts"
      provides: "Zod schema for project validation and TypeScript type inference"
      exports: ["projectSchema", "projectsArraySchema", "Project"]
      min_lines: 20
    - path: "src/data/projects.ts"
      provides: "Validated projects data with const assertion"
      exports: ["projects"]
      contains: "as const"
    - path: "src/types/project.ts"
      provides: "Exported Project type for component consumption"
      exports: ["Project"]
    - path: "src/data/index.ts"
      provides: "Re-exports validated projects through validation layer"
      contains: "projectsArraySchema.parse"
  key_links:
    - from: "src/data/index.ts"
      to: "src/data/schemas/project.schema.ts"
      via: "imports projectsArraySchema and calls .parse()"
      pattern: "projectsArraySchema\\.parse\\(projects\\)"
    - from: "src/data/index.ts"
      to: "src/data/projects.ts"
      via: "imports raw projects array"
      pattern: "import.*projects.*from.*\\.\/projects"
    - from: "src/components/home/Projects.tsx"
      to: "src/types/project.ts"
      via: "imports Project type"
      pattern: "import.*Project.*from.*@\/types\/project"
---

<objective>
Create type-safe project data layer with Zod validation and const-asserted data arrays

**Purpose:** Enable content updates via data file edits while preventing invalid data from reaching production through build-time validation. Transforms the untyped projects array into a validated, type-safe data structure.

**Output:** Schema-validated project data system with TypeScript types extracted from Zod schemas, supporting the existing client component architecture while adding build-time safety.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-project-data-infrastructure/02-RESEARCH.md

# Current architecture
@src/data/index.ts
@src/components/home/Projects.tsx
@src/app/page.tsx

# Phase 1 patterns
@.planning/phases/01-dark-theme-system/01-01-SUMMARY.md
@.planning/phases/01-dark-theme-system/01-02-SUMMARY.md

# Codebase conventions
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/ARCHITECTURE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Zod and create project schema with validation rules</name>
  <files>
    package.json
    package-lock.json
    src/data/schemas/project.schema.ts
    src/types/project.ts
  </files>
  <action>
Install Zod for runtime validation:
```bash
npm install zod
```

Create `src/data/schemas/project.schema.ts` with comprehensive validation:
- Define `projectSchema` using z.object() with these rules:
  - `id`: z.number().positive() — must be positive integer
  - `title`: z.string().min(1).max(100) — required, max 100 chars
  - `description`: z.string().min(10) — required, min 10 chars for meaningful descriptions
  - `image`: z.string().startsWith('/').regex(/\.(jpg|jpeg|png|webp)$/i) — must be absolute path with valid image extension
  - `tags`: z.array(z.string().min(1)).min(1).max(10) — at least 1 tag, max 10
  - `github`: z.string().url().optional() — valid URL or undefined
  - `demo`: z.string().url().optional() — valid URL or undefined
  - `featured`: z.boolean() — explicit true/false
- Define `projectsArraySchema` as z.array(projectSchema).min(1) — require at least one project
- Add custom `.refine()` to projectsArraySchema to validate unique IDs (prevents copy-paste errors)
- Export inferred type: `export type Project = z.infer<typeof projectSchema>`

Create `src/types/project.ts` that re-exports the type for component consumption:
```typescript
export type { Project } from '@/data/schemas/project.schema'
```

Follow patterns:
- Use schema-first type inference (NOT separate type definitions)
- Include clear error messages in validation rules
- Use `.parse()` for static data validation (fail fast), NOT `.safeParse()`
  </action>
  <verify>
Run build to confirm Zod installs without errors:
```bash
npm run build
```

Verify schema file exports:
```bash
node -e "import('./src/data/schemas/project.schema.ts').then(m => console.log(Object.keys(m)))"
```
Should output: projectSchema, projectsArraySchema, Project
  </verify>
  <done>
- Zod added to package.json dependencies
- src/data/schemas/project.schema.ts exists with projectSchema, projectsArraySchema, and type export
- src/types/project.ts exists and re-exports Project type
- Build completes without errors
- Schema includes unique ID refinement check
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate projects array with const assertion and validation layer</name>
  <files>
    src/data/projects.ts
    src/data/index.ts
  </files>
  <action>
Create `src/data/projects.ts` with the existing projects data:
- Copy the current `projects` array from `src/data/index.ts` (lines 37-68)
- Add `as const satisfies readonly Project[]` to make data readonly while maintaining type safety
- Import Project type: `import type { Project } from '@/types/project'`
- Export as named export: `export const projects = [...] as const satisfies readonly Project[]`
- Keep all existing project data intact (3 projects with placeholders)

Update `src/data/index.ts` to add validation layer:
- Import validation: `import { projectsArraySchema } from './schemas/project.schema'`
- Import raw data: `import { projects as rawProjects } from './projects'`
- Add validation and re-export:
```typescript
// Validate projects at build time
// .parse() throws ZodError on validation failure → build fails → prevents invalid data in production
export const projects = projectsArraySchema.parse(rawProjects)
```
- Keep all other exports (siteConfig, navigation, hero, about, contact, footer) unchanged

**Architectural note:** NOT using `server-only` package because Projects.tsx is a client component that directly imports from @/data. The validation still happens at build time when the module is imported, but the validated data needs to be accessible to client components. This adapts the DAL pattern to the existing client-side architecture while maintaining build-time safety.
  </action>
  <verify>
Build the project to trigger validation:
```bash
npm run build
```

Should succeed with current placeholder data. To verify validation works, temporarily break data and confirm build fails:
```bash
# Test: Invalid image path (no leading slash)
# Temporarily change image: '/projects/project1.jpg' → 'projects/project1.jpg'
# Run npm run build
# Should FAIL with Zod error about image path
# Revert change
```
  </verify>
  <done>
- src/data/projects.ts created with 3 existing projects and const assertion
- src/data/index.ts imports and validates projects using projectsArraySchema.parse()
- Build succeeds with valid data
- Build fails with clear Zod error messages when data is invalid (verified by test)
- All existing project data preserved
  </done>
</task>

<task type="auto">
  <name>Task 3: Update Projects component to use typed imports</name>
  <files>
    src/components/home/Projects.tsx
  </files>
  <action>
Update Projects.tsx to import the Project type for type safety:
- Add type import at top: `import type { Project } from '@/types/project'`
- The component already imports `{ projects }` from '@/data' — keep this unchanged
- Projects component doesn't need explicit typing since it directly maps over the imported array
- The type safety comes from the validated data being inferred automatically

**Why minimal changes:** The existing component already works correctly. We're adding the type import to:
1. Enable explicit typing if needed for future enhancements
2. Get autocomplete and IntelliSense for project properties
3. Demonstrate the type is available from a clean import path

No component logic changes needed — validation happens at the data layer, and TypeScript infers types from the validated exports automatically.
  </action>
  <verify>
Run TypeScript compiler to verify type safety:
```bash
npx tsc --noEmit
```

Test dev server starts without errors:
```bash
npm run dev
```
Visit http://localhost:3000 and verify Projects section renders with 3 placeholder projects.

Verify type safety by testing autocomplete: In Projects.tsx, type `project.` and confirm TypeScript shows available properties (id, title, description, image, tags, github, demo, featured).
  </verify>
  <done>
- Projects.tsx imports Project type from @/types/project
- TypeScript compilation succeeds with no errors
- Dev server starts successfully
- Projects section renders correctly with placeholder data
- IntelliSense shows typed project properties
  </done>
</task>

</tasks>

<verification>
## Build-Time Validation Check

Run full build to confirm validation pipeline works:
```bash
npm run build
```

Expected: Build succeeds, validates all 3 projects against schema, outputs static site to `out/`.

## Type Safety Verification

Test that invalid data is caught:

1. **Invalid ID test:**
   - Edit src/data/projects.ts, change `id: 1` to `id: -1`
   - Run `npm run build`
   - Should FAIL with error: "Number must be greater than 0"
   - Revert change

2. **Invalid image path test:**
   - Change `image: '/projects/project1.jpg'` to `image: 'projects/project1.jpg'`
   - Run `npm run build`
   - Should FAIL with error: "Image path must start with /"
   - Revert change

3. **Missing required field test:**
   - Remove `description` from a project
   - Run `npm run build`
   - Should FAIL with error: "Required"
   - Revert change

4. **Duplicate ID test:**
   - Change project 2 and 3 to both have `id: 2`
   - Run `npm run build`
   - Should FAIL with custom refinement error about duplicate IDs
   - Revert change

All tests should fail the build with clear Zod error messages. Final `npm run build` should succeed with valid data.

## Component Integration Check

Start dev server and verify rendering:
```bash
npm run dev
```

Visit http://localhost:3000:
- [ ] Projects section displays 3 placeholder projects
- [ ] Each project shows title, description, and tech tags
- [ ] No console errors
- [ ] No hydration warnings
- [ ] Project cards maintain existing layout and styling

## Type Safety in Editor

Open src/components/home/Projects.tsx:
- [ ] Typing `project.` shows autocomplete with id, title, description, image, tags, github, demo, featured
- [ ] No TypeScript errors in file
- [ ] Hover over `projects` variable shows type `readonly [...]` (inferred from const assertion)
</verification>

<success_criteria>
Phase 2 is complete when:

1. **Data model validation works:**
   - [ ] Zod schema defines all project fields with appropriate constraints
   - [ ] Invalid project data causes build to fail with clear error messages
   - [ ] Valid project data builds successfully to static export

2. **Type safety is enforced:**
   - [ ] Project type is inferred from Zod schema using z.infer
   - [ ] Components importing projects get full TypeScript autocomplete
   - [ ] No manual type definitions that could drift from validation rules

3. **Architecture supports content editing:**
   - [ ] Projects are defined in src/data/projects.ts data file
   - [ ] Adding new projects requires only editing the data array
   - [ ] No code changes needed to add/remove/edit project entries
   - [ ] Data is const-asserted for immutability guarantees

4. **Existing functionality preserved:**
   - [ ] All 3 placeholder projects render correctly on homepage
   - [ ] Projects component layout and styling unchanged
   - [ ] No new runtime errors or warnings
   - [ ] Static export still works (output: 'export' compatible)

**Requirement coverage:** PROJ-04 (Projects driven by data file) ✓
</success_criteria>

<output>
After completion, create `.planning/phases/02-project-data-infrastructure/02-01-SUMMARY.md` following the summary template.

Include in summary:
- Decision to skip `server-only` due to client component architecture
- Validation approach using .parse() at module import time
- Const assertion pattern with satisfies for type safety
- Build-time safety guarantees from Zod validation
</output>
